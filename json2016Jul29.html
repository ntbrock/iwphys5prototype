<html><head><title>JSON navigation sample - 2016Jul29</title>

    <script type="text/javascript" src="./js/jquery-3.0.0.js"></script>

</head>

<body>
  <h1>IWP JSON Parsing Unit Test</h1>

  <div id="problem" problem-uri="clone-problemServer/packagedProblems/Oscillations/shm-01.json"></div>

  <h3 id="authorUsername">Loading...</h3>

  <h3>Time</h3>
  <div id="time">
    <span id="digClock"></span>
    OTHER TIME CONTROLS SHOULD BE BROUGHT IN
  </div>

  <h3>Description</h3>
  <div id="description"></div>

  <h3>Window Settings</h3>
  <div id="iwindow">
    X min: <input id="iwindow_xmin" type="text"><br/>
    X max: <input id="iwindow_xmax" type="text"><br/>
    X grid: <input id="iwindow_xgrid" type="text"><br/>
    X unit: <input id="iwindow_xunit" type="text"><br/>
    Y min: <input id="iwindow_ymin" type="text"><br/>
    Y max: <input id="iwindow_ymax" type="text"><br/>
    Y grid: <input id="iwindow_ygrid" type="text"><br/>
    Y unit: <input id="iwindow_yunit" type="text"><br/>
</div>

  <h3>GraphWindow</h3>
  <div id="graphWindow"></div>

  <h3>Inputs</h3>
  <div id="inputs"></div>

  <h3>Outputs</h3>
  <div id="outputs"></div>

  <h3>Solids</h3>
  <div id="solids"></div>


  <hr/>



  <script type="text/javascript">

    var time = {};
    var description = "";
    var iwindow = {};
    var graphWindow = {};
    var inputs = [];
    var outputs = [];
    var solids = [];


    // "time": { "start": "0.0", "stop": "5.0", "change": "0.02",  "fps": "25.0" },
    function setTime(inTime) { 
       console.log("time :", inTime);
       time = inTime;
    }

    // "description": { "text": "A ball is attached to a horizontal spring (not shown) which causes the ball to oscillate about the origin. Run the animation until it stops. Click on Show graph. \n\nWhich graph represents position vs. time?  How do you know?\nWhich graph represents velocity vs. time?  How do you know?\nWhich graph represents acceleration vs. time?  How do you know?\n\nWhat would a graph of net force on the ball vs. time look like?  Why?" 
    function setDescription(inDescription) { 
       console.log("description :", inDescription);
       description = inDescription;
    }

    // "window": { "xmin": "-10.0", "xmax": "10.0", "ymin": "-10.0", "ymax": "10.0", "xgrid": "2.0", "ygrid": "1.0", "xunit": "meters", "yunit": "meters"
    function setWindow(inWindow) { 
      console.log("window :", inWindow);
      iwindow = inWindow;
    }


    // "GraphWindow": { "xmin": "0.0", "xmax": "5.0", "ymin": "-50.0", "ymax": "50.0", "xgrid": "0.5", "ygrid": "10.0"
    function setGraphWindow(inGraphWindow) {
      console.log("graphWindow :", inGraphWindow);
      graphWindow = inGraphWindow;
    }


    function addInput(input) { 
      console.log("input: ", input );
      // {name: "ar", text: "Amplitude", initialValue: "9.0", units: "m"}
      inputs.push( "<div id='input_" + input.name + "'><label for='"+ input.name +"'>"+ input.text +"</label> <input id='" + input.name + "' type='text' value='" + input.initialValue + "'> " + input.units + "</div>");
    }

    function addOutput(output) { 
      console.log("output ", output );
   
      // { "name": "axr", "text": "Acceleration", "units": "m/ss", "calculator": { "@attributes": { "type": "parametric" }, "value": "Red.xaccel" } }
      outputs.push( "<div id='output_" + output.name + "'><label for='"+ output.name +"'>"+ output.text +"</label> <input id='" + output.name + "' type='text' value='-999'> " + output.units + "</div>");
    }

    function addSolid(solid) { 
      console.log("solid: ", solid );
      solids.push( "<p style='background-color: rgb(" +solid.color.red+ "," +solid.color.green+ "," +solid.color.blue+ ");'> " + solid.name + "</p>" );
    }





    
    function parseProblemToMemory( problem ) { 

      $("#authorUsername").html( problem.author.username );

      // Time
      setTime(problem.objects.time);

      // Description
      setDescription(problem.objects.description);

      // Window
      setWindow(problem.objects.window);

      // GraphWindow
      setGraphWindow(problem.objects.graphWindow);


      // Inputs - These could be an array OR a single item.
      if ( $.type ( problem.objects.input ) == 'array' ) { 
        $.each( problem.objects.input, function( index, input ) {
          addInput(input);
        });
      } else { 
        addInput(problem.objects.input);
      }

      // Output - These could be an array OR a single item.
      if ( $.type ( problem.objects.output ) == 'array' ) { 
        $.each( problem.objects.output, function( index, output ) {
          addOutput(output);
        });
      } else { 
        addOutput(problem.objects.output);
      }

      // Solids - These could be an array OR a single item.
      if ( $.type ( problem.objects.solid ) == 'array' ) { 
        $.each( problem.objects.solid, function( index, solid ) {
          addSolid(solid);
        });
      } else { 
        addSolid(problem.objects.solid);
      }
    }

    function renderProblemFromMemory() { 
      // Render from memory into page

      $("#digClock").html( time.start );
      $("#description").html( description.text );
    
    console.log("setting xmin val: ", iwindow.xmin );
      $("#iwindow_xmin").val( iwindow.xmin );
      $("#iwindow_xmax").val( iwindow.xmax );
      $("#iwindow_xgrid").val( iwindow.xgrid );
      $("#iwindow_xunit").val( iwindow.xunit );
      $("#iwindow_ymax").val( iwindow.ymax );
      $("#iwindow_ymin").val( iwindow.ymin );
      $("#iwindow_ygrid").val( iwindow.ygrid );
      $("#iwindow_yunit").val( iwindow.yunit );

    // GraphWindow is a TODO feature for now.
    // $("#graphWindow").html( graphWindow );
    
      $("#inputs").html( inputs.join(" ") );
      $("#outputs").html( outputs.join(" ") );
      $("#solids").html( solids.join(" ") );

      renderCanvasFromMemory();
      addSolidsToCanvas(solids);
    }


    function renderCanvasFromMemory() { 


    }

    function addSolidsToCanvas(solids) {

    }


    // On Pageload, pull our hardcoded unit test.
    $.getJSON( $('#problem').attr('problem-uri'), function( problem ) {
      parseProblemToMemory(problem);
      renderProblemFromMemory();
    });

  </script>

</body>
<html>
